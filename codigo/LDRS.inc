;------------------------------------------------------------------

						HEADER DE LOS LDR'S

;------------------------------------------------------------------

LDRS_INIT:
	LDI AUX,LOW(LDR_NO_VEC)
	MOV LDR_NO_LOW,AUX
	LDI AUX,HIGH(LDR_NO_VEC)
	MOV LDR_NO_HIGH,AUX

	LDI AUX,LOW(LDR_SO_VEC)
	MOV LDR_SO_LOW,AUX
	LDI AUX,HIGH(LDR_SO_VEC)
	MOV LDR_SO_HIGH,AUX

	LDI AUX,LOW(LDR_SE_VEC)
	MOV LDR_SE_LOW,AUX
	LDI AUX,HIGH(LDR_SE_VEC)
	MOV LDR_SE_HIGH,AUX

	LDI AUX,LOW(LDR_NE_VEC)
	MOV LDR_NE_LOW,AUX
	LDI AUX,HIGH(LDR_NE_VEC)
	MOV LDR_NE_HIGH,AUX

	INPUT AUX,CONTADOR
	CLR AUX
	OUTPUT CONTADOR,AUX
RET

READ_LDRS:

	RLDR LDR_NO								;READ_LDR:	DEVUELVE EL RESULTADO DE LA CONVERSION EN ADC_DATA_H
	SLDR LDR_NO_LOW,LDR_NO_HIGH,ADC_DATA_H	;STORE_LDR:	UBICA [LDR_XX_LOW,LDR_XX_HIGH] EN UN PUNTERO Y GUARDA ADC_DATA_H

	RLDR LDR_SO								;READ_LDR:	DEVUELVE EL RESULTADO DE LA CONVERSION EN ADC_DATA_H
	SLDR LDR_SO_LOW,LDR_SO_HIGH,ADC_DATA_H	;STORE_LDR:	UBICA [LDR_XX_LOW,LDR_XX_HIGH] EN UN PUNTERO Y GUARDA ADC_DATA_H

	RLDR LDR_SE								;READ_LDR:	DEVUELVE EL RESULTADO DE LA CONVERSION EN ADC_DATA_H
	SLDR LDR_SE_LOW,LDR_SE_HIGH,ADC_DATA_H	;STORE_LDR:	UBICA [LDR_XX_LOW,LDR_XX_HIGH] EN UN PUNTERO Y GUARDA ADC_DATA_H

	RLDR LDR_NE								;READ_LDR:	DEVUELVE EL RESULTADO DE LA CONVERSION EN ADC_DATA_H
	SLDR LDR_NE_LOW,LDR_NE_HIGH,ADC_DATA_H	;STORE_LDR:	UBICA [LDR_XX_LOW,LDR_XX_HIGH] EN UN PUNTERO Y GUARDA ADC_DATA_H

	INPUT AUX,COUNTER
	INC AUX
	OUTPUT COUNTER,AUX
	CPI AUX,CANT_SAMPLES
	BREQ HACER_PROMEDIO
	CLC										;SI NO HIZO EL PROMEDIO: [CARRY=0].
	FIN_HACER_PROMEDIO:
RET

HACER_PROMEDIO:
	LDI	AUX,CANT_SAMPLES					;VECTMEAN NECESITA LA CANTIDAD DE LAS MUESTRAS

	LLDR Z,LDR_NO_LOW,LDR_NO_HIGH			;UBICO EL LDR_NO EN UN PUNTERO.
	VECTMEAN Z,AUX,AUX1						;CALCULO EL PROMEDIO DE Z DE LARGO "AUX" DEJANDO EL DATO EN "AUX1"
	OUTPUT LDR_NO_MEAN,AUX1					;GUARDAMOS EN RAM EL PROMEDIO.

	LLDR Z,LDR_SO_LOW,LDR_SO_HIGH			;UBICO EL LDR_SO EN UN PUNTERO.
	VECTMEAN Z,AUX,AUX1						;CALCULO EL PROMEDIO DE Z DE LARGO "AUX" DEJANDO EL DATO EN "AUX1"
	OUTPUT LDR_SO_MEAN,AUX1					;GUARDAMOS EN RAM EL PROMEDIO.

	LLDR Z,LDR_SE_LOW,LDR_SE_HIGH			;UBICO EL LDR_SE EN UN PUNTERO.
	VECTMEAN Z,AUX,AUX1						;CALCULO EL PROMEDIO DE Z DE LARGO "AUX" DEJANDO EL DATO EN "AUX1"
	OUTPUT LDR_SE_MEAN,AUX1					;GUARDAMOS EN RAM EL PROMEDIO.

	LLDR Z,LDR_NE_LOW,LDR_NE_HIGH			;UBICO EL LDR_NE EN UN PUNTERO.
	VECTMEAN Z,AUX,AUX1						;CALCULO EL PROMEDIO DE Z DE LARGO "AUX" DEJANDO EL DATO EN "AUX1"
	OUTPUT LDR_NE_MEAN,AUX1					;GUARDAMOS EN RAM EL PROMEDIO.

	RCALL LDRS_INIT							;RESETEO LOS PUNTEROS.

	SEC										;SI VINO A HACER EL PROMEDIO: [CARRY=1].
RJMP FIN_HACER_PROMEDIO